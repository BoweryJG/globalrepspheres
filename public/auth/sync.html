<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth Sync - RepSpheres</title>
</head>
<body>
  <script>
    // This page handles cross-domain auth sync messages
    window.addEventListener('message', (event) => {
      // Validate origin
      const validOrigins = [
        'https://globalrepspheres.netlify.app',
        'https://marketdata.repspheres.com',
        'https://canvas.repspheres.com',
        'https://crm.repspheres.com'
      ];
      
      if (!validOrigins.includes(event.origin) && !event.origin.includes('localhost')) {
        return;
      }
      
      // Handle auth state sync
      if (event.data.type === 'AUTH_STATE_SYNC') {
        // Store the session data in localStorage for this domain
        if (event.data.session) {
          localStorage.setItem('repspheres-auth-sync', JSON.stringify({
            session: event.data.session,
            timestamp: Date.now()
          }));
        } else {
          localStorage.removeItem('repspheres-auth-sync');
        }
        
        // Reload the page to pick up the new auth state
        window.location.reload();
      }
    });
    
    // Close window after a short delay if opened as iframe
    if (window.parent !== window) {
      setTimeout(() => {
        window.close();
      }, 2000);
    }
  </script>
</body>
</html>